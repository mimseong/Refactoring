## 8장 기능 이동

### 8.1 함수 옮기기

- 함수를 적절한 컨텍스트로 옮겨주자
- 모듈성이란 프로그램의 어딘가를 수정하려 할 때 해당 기능과 깊이 관련된 작은 일부만 이해해도 가능하게 해주는 능력
- 적절한 위치 선정 방법
	- 대상 함수의 컨텍스트 살펴보기
	- 대상 함수를 호출하는 함수, 대상 함수가 호출하는 함수
	- 사용하는 데이터는 무엇인지
- 함수의 최적 장소를 정하기 어려울 수 있으나 선택이 어려울수록 큰 문제가 아닌 경우가 많다

**예시**

- 중첩함수의 단점: 중첩 함수를 사용하다 보면 숨겨진 데이터끼리 상호 의존하기가 아주 쉬우니 되도록 만들지 말자
- 소스 컨텍스트에서 가져와야 할 데이터가 많다면?
	- 데이터를 많이 넘겨야 한다면 객체 자체를 넘기기

### 8.2 필드 옮기기

**데이터 구조의 중요성**
	- 적합한 데이터 구조를 활용하면 동작 코드는 자연스럽게 단순하고 직관적으로 짜여진다
	- 데이터 구조를 잘못 사용하면? 아귀가 맞지 않는 데이터를 다루기 위한 코드로 범벅이 된다
- 현재 데이터 구조가 적절치 않음을 깨닫게 되면 곧바로 수정해야 한다
- 고치지 않을시 훗날 작성하게 될 코드가 더욱 복잡해진다

**함수에 항상 함께 건네지는 데이터 조각**

- 상호관계가 잘 드러나도록 한 레코드에 담기

**레코드를 변경할 때 다른 레코드의 필드까지 변경해야 한다면?**

- 필드 위치가 잘못되었다는 신호
- 한 번만 갱신해도 되는 다른 위치로 옮기라는 신호

### 8.3 문장을 함수로 옮기기

- 특정 함수 호출시 앞이나 뒤에 똑같은 코드가 실행된다면?
- 반복되는 부분을 피호출 함수로 합친다

**예시**

- 함수를 바로 안 옮기고 새로운 함수를 만든 다음 변경

### 8.4 문장을 호출한 곳으로 옮기기

- 초기에는 응집도 높고 한 가지 일만 수행하던 함수가 어느새 둘 이상의 다른 일을 수행하게 바뀔 수 있다 (공감한다)
- 일부 호출자에게는 다르게 동작하도록 바뀌어야 하는 경우
	- 달라지는 부분만 분리한다
	- (반성.. 예전에는 if 문으로 조건을 걸었다) 

**예시**

- 위치만 다르게 동작해야 한다
- 남길 부분을 새로운 함수로 추출한다
- 다르게 동작하는 부분을 하나씩 분리한다
- 새로운 함수의 이름을 원래 함수 이름으로 되돌린다

### 8.5 인라인 코드를 함수 호출로 바꾸기

- 함수의 이름이 코드의 동작방긱보다는 목적을 말해주기 때문에 코드를 이해하기 쉬워진다
- 함수는 중복을 없애는 데도 효과적이다
- 특히 라이브러리가 제공되는 함수로 대체할 수 있다면 훨씬 좋다
- 함수 본문을 작성할 필요 조차도 없다

### 8.6 문장 슬라이드하기

- 관련된 코드들이 가까이 모여있다면 이해하기가 더 쉽다
- 변수를 처음 사용할 때 선언 (나도 선호한다)

**예시**

- 무엇을 슬라이드할지, 슬라이드할 수 있는지 여부
- 테스트를 믿을 수 없다면 리팩터링을 더 신중히 진행
- 또는 당장의 리팩터링에 영향받는 코드의 테스트를 보강

```
건너뛰어지는 코드들도 부수효과가 없다는 점이 도움됐다.
사실 부수효과가 없는 코드끼리는 마음가는 대로 재배치할 수 있다.
현명한 프로그래머들이 되도록 부수효과 없는 코드들로 프로그래밍하는 이유 중 하나다.
```

**예시 - 조건문이 있을 때의 슬라이드**

- 조건문 안으로 보낸다: 중복이 추가된다
- 조건문 밖으로 뺀다: 중복이 제거된다

### 8.7 반복문 쪼개기

- 반복문에 두 일을 한번에 처리하는 경우
	- 반복문을 수정할 때마다 두 가지 일 모두 잘 이해하고 진행해야 한다
- 반복문 쪼개기는 서로 다른 일들이 한 함수에서 이뤄지고 있다는 신호

**예시**

- `가장 어린 나이 / 전체 급여`
- 두 가지 동작을 하나의 반복문에서 계산하고 있다

**더 가다듬기**

- 반복문 쪼개기는 다음 단계로 가는 디딤돌 역할에 있다
- 함수로 추출하면 어떨지까지 한 묶음으로 고민해보자
- `가장 어린 나이 / 전체 급여` 반복문 각각을 함수로 분리
- `알고리즘 교체 / 파이프라인으로 교체` 리팩터링

### 8.8 반목문을 파이프라인으로 바꾸기

- 파이프라인 사용시
	- 처리 과정을 일련의 연산으로 표현 가능
	- 객체가 파이프라인을 따라 흐르며 어떻게 처리되는지 읽을 수 있다

### 8.9 죽은 코드 제거하기

- 사용되지 않는 코드가 있다면 소프트웨어 동작을 이해하는 데 커다란 걸림돌이 될 수 있다
- `"절대 호출되지 않으니 무시해도 되는 함수다"` 라는 신호를 주지 않기 때문
- 이런 함수들의 동작을 파악하기 위해 시간을 허비하게 된다
- 코드가 다시 필요해질 날이 오지 않을까 걱정할 필요 없다
- 우리에게 버전 관리 시스템이 있다!

