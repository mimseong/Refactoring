# 02 리팩터링 원칙

## 2.1 리팩터링 정의
- 리팩터링: 소프트웨어의 겉보기 동작은 그대로 유지한 채, 코드를 이해하고 수정하기 쉽도록 내부 구조를 변경하는 기법
- 리팩터링하다: 소프트웨어의 겉보기 동작은 그대로 유지한 채, 여러가지 리팩터링 기법을 적용해서 소프트웨어를 재구성하다.

> 동작을 유지하는 작은 단계를 순차적으로 거쳐서 큰 변화를 만들어내는 일.

- 재구성(restructuring): 코드베이스를 정리하거나 구조를 바꾸는 것
  - 리팩터링은 재구성의 한 형태.

- 리팩터링의 목적: 코드를 이해, 수정하기 쉽게 만드는 것.
  - __리팩터링 전과 후의 코드는 똑같이 동작해야 한다.__

## 2.2 두개의 모자
‘기능 추가’ vs ‘리팩터링’

- 기능을 추가할 때는 기존코드는 건드리지 않고 기능 추가만!
- 리팩터링할 때는 기능 추가는 절대 하지 않는다!

(이 부분도 익혀야할 것이라고 생각되는게, 기능 추가를 하다가도 리팩터링하고 싶은 게 있어서 자꾸 딴길로 새는 경우가 있다. 어떤 작업을 할 때는 당장 목표로하는 것만 진행하고 마무리되면 다른 작업을 진행하자.)

## 2.3 리팩터링 하는 이유

1. 리팩터링하면 소프트웨어 설계가 좋아진다.</br>
    - 아키텍쳐를 이해하지 못한 채 단기 목표만을 위해 코드를 수정하다보면 구조가 무너지기 쉽다. 
      - 코드만 봐서는 설계를 파악하기 어려워진다.
      - 코드가 길고 중복이 많을수록 실수할 확률이 커지고 이해해야할 코드의 양이 늘어난다.
    - 중복코드를 제거하면 모든 코드가 언제나 고유한 일을 수행함을 보장할 수 있다. (바람직한 설계)</br>

2.  리팩터링하면 소프트웨어를 이해하기 쉬워진다.</br>
    - 프로그램을 동작시키는데만 열중하면 다른 개발자에 대한 배려를 하지 못함.
    - 꼭 다른 사람이 아니라 나 자신을 위한 배려일 수도?
      - 작성한 코드를 모두 기억하고 있지는 않기 때문에 나중에 다시 이해할 나를 위한 배려

3.  버그를 쉽게 찾을 수 있다.</br>
	  - 리팩터링을하면 코드가 하는 일을 깊이 파악하게 되면서 버그를 찾기 더 쉬워진다.

4. 프로그래밍 속도를 높일 수 있다.</br>
    - 코드베이스가 늘어날수록 새로운 기능 추가하는데 시간이 오래 걸린다. 리팩터링을 하면 개발 시간이 줄어들 수 있다.
      - 나쁜설계: 기능이 누적될 수록 개발 속도 저하
      - 좋은설계: 기능이 누적되어도 개발 속도 비교적 빠름
        - 내부설계가 잘 되면(모듈화가 잘 되면) 전체 코드 중 일부만 이해하면 된다. 

    - 지구력 가설: 내부 설계에 심혈을 기울이면 소프트웨어의 지구력이 높아져서 빠르게 개발할 수 있는 상태를 오래 지속한다…는 가설

## 2.4 언제 리팩터링해야할까?

> 3의 법칙
> 1.  그냥 한다.
> 2. 비슷한 일을 두번째로 하게되면 당황스럽지만 일단 그냥 한다.
> 3. 비슷한 일을 세번째 하게되면 리팩터링한다.
 
#### 💛 준비를 위한 리팩터링: 기능을 쉽게 추가하게 만들기
- 기능을 새로 추가하기 직전 바꿀 수 있을 만한것 찾아보기
- 함수는 복제하지 않고 **함수 매개변수화하기** 활용
- 중복된 코드에서 버그가 발생했다면 하나로 합치는 것이 좋음

#### 💛 이해를 위한 리팩터링: 코드를 이해하기 쉽게 만들기
- 코드 파악 우선
- 코드를 이해하며 리팩터링 해보기 (함수 나누기, 이름 바꾸기 등..)

#### 💛 쓰레기 줍기 리팩터링
- 간단히 수정할 수 있는 것은 바로 수정
- 시간이 걸릴 것 같으면 메모해둔 후, 나중에 처리
- 시간이 걸리더라도 조금이나마 개선해두는 것이 좋다.

#### 💛 계획된 리팩터링과 수시로 하는 리팩터링
- 리팩터링 시간을 따로 잡아두지 않고, 기능을 추가하거나 버그를 잡을 때 수시로 리팩터링 한다.
- 계획된 리팩터링은 최소한으로

#### 💛 오래 걸리는 리팩터링
- 팀 전체가 진행하는 대규모 리팩터링
	- 보다는 주어진 문제를 몇 주에 걸쳐 조금씩 해결해가는 편이 효과적.
	- ex) 라이브러리 교체를 할 경우, 기존 라이브러리와 새 라이브러리를 포용하는 추상 인터페이스를 먼저 마련하고 점차 리팩터링

#### 💛 코드 리뷰에 리팩터링 활용하기
- 코드 리뷰를 하면 다른 사람의 아이디어를 얻을 수 있다.
- 짝 프로그래밍이 효과적

#### 💛 관리자에게는 뭐라고 말해야할까?
- 관리자가 기술을 잘 모른다면 "말하지 말라"

#### 💛 리팩터링하지 말아야할 때
- 외부 API 다루듯 호출해서 쓰는 코드
- 처음부터 새로 작성하는 게 쉬울 때


## 2.5 리팩터링 시 고려할 문제

### 새 기능 개발 속도 저하
- 리팩터링의 궁극적 목표는 개발 속도 높이기
- 리팩터링의 본질은 코드를 예쁘게 하는 것이 아닌 경제적인 목적

### 코드 소유권
- 코드 소유권이 나뉘어있으면 리팩터링에 방해가 된다.
